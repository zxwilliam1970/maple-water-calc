<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>楓之谷補水效率助手（Artale版）｜法師（火毒）</title>
<style>
  :root{--bg:#0b1020;--card:#101935;--muted:#8ea0c7;--fg:#e9efff;--acc:#7bdcff;--grid:#1c2647;--ok:#2fd67f;--warn:#f7bf45;--bad:#ff6b6b}
  *{box-sizing:border-box} html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans"}
  .container{max-width:1100px;margin:0 auto;padding:16px}
  .brand{display:flex;align-items:center;gap:12px;margin:8px 0 16px}
  .brand h1{font-size:20px;margin:0}
  .subtitle{color:var(--muted);font-size:13px}
  .grid{display:grid;grid-template-columns:1fr;gap:12px}
  @media (min-width:960px){ .grid{grid-template-columns: 1fr 1fr } }
  .card{background:var(--card);border:1px solid var(--grid);border-radius:14px;padding:14px}
  .card h2{margin:2px 0 10px;font-size:16px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .row3{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
  .row4{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
  label{font-size:12px;color:var(--muted)}
  input,select{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--grid);background:#0e1730;color:var(--fg);font-size:14px}
  .help{font-size:12px;color:var(--muted)}
  .result{display:grid;gap:8px}
  .callout{border-left:4px solid var(--acc);background:#0f1a39;padding:10px 12px;border-radius:8px}
  .ok{border-left-color:var(--ok)} .warn{border-left-color:var(--warn)} .bad{border-left-color:var(--bad)}
  table{width:100%;border-collapse:separate;border-spacing:0 6px}
  th,td{text-align:left;font-size:13px;padding:8px 10px;background:#0e1730;border:1px solid var(--grid)}
  th{color:#b9c8ef;background:#0c1630}
  tr>td:first-child, tr>th:first-child{border-top-left-radius:10px;border-bottom-left-radius:10px}
  tr>td:last-child, tr>th:last-child{border-top-right-radius:10px;border-bottom-right-radius:10px}
  .muted{color:var(--muted)}
  .badge{display:inline-block;padding:2px 8px;border-radius:999px;background:#14224a;border:1px solid var(--grid);font-size:12px;margin-left:6px}
  .btn{background:linear-gradient(180deg,#2a74ff,#2156c9);border:none;color:#fff;padding:10px 14px;border-radius:10px;font-weight:600;cursor:pointer}
  .btn:disabled{opacity:.6;cursor:not-allowed}
  .footer{margin:16px 0 40px;color:var(--muted);font-size:12px}
</style>
</head>
<body>
<div class="container">
  <div class="brand">
    <svg width="28" height="28" viewBox="0 0 24 24" fill="none"><path d="M3 13c4 0 7-3 7-7 0 0 0 0 0 0 0 4 3 7 7 7 0 0 0 0 0 0-4 0-7 3-7 7 0 0 0 0 0 0 0-4-3-7-7-7Z" fill="#7BDcff"/></svg>
    <div>
      <h1>楓之谷補水效率助手（Artale版）</h1>
      <div class="subtitle">法師（火毒）｜%自動補建議、678、下一刀可承受、最省補品組合</div>
    </div>
  </div>

  <!-- 基本輸入 -->
  <div class="grid">
    <div class="card">
      <h2>角色與環境</h2>
      <div class="row">
        <div><label>最大 HP</label><input id="maxHP" type="number" min="1" value="1200" /></div>
        <div><label>最大 MP</label><input id="maxMP" type="number" min="1" value="7000" /></div>
      </div>
      <div class="row" style="margin-top:8px">
        <div><label>被撞 / 單次傷害（估）</label><input id="hitDmg" type="number" min="1" value="1350" /></div>
        <div>
          <label>自動補模式</label>
          <select id="autoMode">
            <option value="678" selected>678 理論</option>
            <option value="700">目標 700</option>
            <option value="800">目標 800</option>
            <option value="manual">手動輸入 %</option>
          </select>
        </div>
      </div>
      <div class="row" id="manualRow" style="margin-top:8px;display:none">
        <div><label>HP％ 門檻</label><input id="hpPctManual" type="number" min="1" max="99" value="80" /></div>
        <div><label>MP％ 門檻</label><input id="mpPctManual" type="number" min="1" max="99" value="10" /></div>
      </div>
      <div class="help" style="margin-top:8px">678 會用 ⌊678/最大MP⌋% 作 MP門檻；實際目標取「此門檻」與「下一刀可承受」的較大值。</div>
    </div>

    <!-- 技能 -->
    <div class="card">
      <h2>技能等級（可互動）</h2>
      <div class="row4">
        <div><label>魔心防禦 Lv.</label><select id="mgLv"></select></div>
        <div><label>魔力之盾 Lv.</label><select id="maLv"></select></div>
        <div><label>瞬間移動 Lv.</label><select id="teleLv"></select></div>
        <div><label>魔力激發 Lv.</label><select id="ampLv"></select></div>
      </div>
      <div class="row" style="margin-top:8px">
        <div><label>毒霧 Lv.</label><select id="poisonMistLv"></select></div>
        <div><label>致命毒霧 Lv.</label><select id="poisonFogLv"></select></div>
      </div>
      <div class="help" style="margin-top:8px">此工具只計入「耗魔/耗血」與魔心替代率；輸出僅影響補水計算。</div>
    </div>
  </div>

  <!-- 價格來源 -->
  <div class="card" style="margin-top:12px">
    <h2>補品價格來源</h2>
    <div class="row">
      <div>
        <label>價格模式</label>
        <select id="priceMode">
          <option value="min" selected>用最低價（經濟實惠）</option>
          <option value="loc">指定地點價格</option>
        </select>
      </div>
      <div>
        <label>指定地點（搭配上方「指定地點價格」使用）</label>
        <select id="priceLoc" disabled></select>
      </div>
    </div>
    <div class="help" style="margin-top:8px">切到「指定地點」時，推薦與表格都會以該地點價計算。</div>
  </div>

  <!-- 結果 -->
  <div class="grid" style="margin-top:12px">
    <div class="card">
      <h2>建議自動補門檻 & 每刀實際消耗</h2>
      <div class="result" id="summary"></div>
      <div style="margin-top:10px"><button class="btn" id="recalc">重新計算</button></div>
    </div>
    <div class="card">
      <h2>推薦補品組合（事件成本最省）</h2>
      <div id="reco"></div>
    </div>
  </div>

  <!-- 表格 -->
  <div class="card" style="margin-top:12px">
    <h2>補品資料（Artale 版） <span class="badge" id="badgePriceMode">最低價</span></h2>
    <div class="help">CP = 補量 / 價格；同品多地點會依目前模式顯示。</div>

    <h3 style="margin:14px 0 6px">HP 藥水</h3>
    <div id="hpTable"></div>

    <h3 style="margin:14px 0 6px">MP 藥水</h3>
    <div id="mpTable"></div>

    <h3 style="margin:14px 0 6px">綜合（HP&MP）</h3>
    <div id="mixTable"></div>
  </div>

  <div class="footer">Artale-整合最終版。計算以「單次觸發的事件成本」為主，確保自動補後仍能承受下一刀；請依實戰再微調門檻。</div>
</div>

<script>
/* ================= 資料：技能 ================= */
const MAGIC_GUARD = Array.from({length:20}, (_,i)=>{
  const lv=i+1, ratio=[4,8,12,16,20,24,28,32,36,40,44,48,52,56,60,64,68,72,76,80][i];
  const mpCost = lv<=10?6:12;
  const durSec = [30,60,90,120,150,180,210,240,270,300,330,360,390,420,450,480,510,540,570,600][i];
  return {lv, ratio, mpCost, durSec};
});
const MAGIC_ARMOR = Array.from({length:20}, (_,i)=>{
  const lv=i+1, mpCost=lv<=10?8:16, durSec=[20,40,60,80,100,120,140,160,180,200,220,240,260,280,300,320,340,360,380,400][i];
  return {lv, mpCost, durSec, def:2*lv};
});
const TELEPORT = Array.from({length:20}, (_,i)=>({lv:i+1, mp:[60,57,54,51,48,45,42,39,36,33,31,29,27,25,23,21,19,17,15,13][i]}));
const POISON_MIST = Array.from({length:30}, (_,i)=>({lv:i+1, mp:(i+1)<=15?10:20}));
const POISON_FOG  = Array.from({length:30}, (_,i)=>({lv:i+1, mp:21+(i)})); // 1→21, 30→50
const SPELL_BOOST = Array.from({length:20},(_,i)=>({lv:i+1,hp:[58,56,54,52,50,48,46,44,42,40,39,38,37,36,35,34,33,32,31,30][i],mp:[53,51,49,47,45,43,41,39,37,35,34,33,32,31,30,29,28,27,26,25][i]}));
const AMP_MAGIC   = Array.from({length:30},(_,i)=>({lv:i+1,costPct:[105,110,115,120,125,130,135,140,145,150,160,155,165,160,170,165,175,170,180,175,185,180,190,185,195,190,205,200,195,200][i], dmgPct:[107,109,111,113,114,115,116,117,118,119,121,121,123,123,125,125,127,127,129,129,131,131,133,133,135,135,137,137,137,140][i]}));

/* ================= 資料：補品（Artale 多地點） ================= */
const HP_POTS = [
  {name:"蘋果", amount:30, prices:{ "防衛本部":28, "其餘地圖":30 }},
  {name:"紅色藥水/雞蛋", amount:50, prices:{ "玩具城/糖果機/防衛本部":47, "其餘地圖":50 }},
  {name:"烤肉", amount:100, prices:{ "全藥水店均一價":106 }},
  {name:"橘色藥水", amount:150, prices:{ "玩具城/糖果機/防衛本部":152, "其餘地圖":160 }},
  {name:"炸雞", amount:200, prices:{ "玩具城/糖果機":209, "螞蟻洞":220 }},
  {name:"白色藥水", amount:300, prices:{ "玩具城/糖果機/防衛本部":304, "煉金術士珍任務":310, "其餘地圖":320 }},
  {name:"大熱狗", amount:300, prices:{ "玩具城/糖果機":304, "螞蟻洞":320 }},
  {name:"披薩/漢堡", amount:400, prices:{ "玩具城/糖果機":427, "螞蟻洞":450 }},
  {name:"熱狗堡", amount:500, prices:{ "玩具城/糖果機":503, "螞蟻洞":530 }},
  {name:"烤鰻魚", amount:1000, prices:{ "防衛本部":1045, "煉金術士珍任務":1060, "多地區通用價":1100, "愛塔-糖果機":1144 }},
  {name:"棒冰棒", amount:2000, prices:{ "玩具城/糖果機/防衛本部":2185, "多地區通用價":2300 }},
  {name:"乳酪", amount:4000, prices:{ "冰原/童話村/不夜城/桃花仙境":4500, "愛塔/防衛本部/時間通道":4680 }},
  {name:"馴鹿奶", amount:5000, prices:{ "冰原/防衛本部/童話村/不夜城/桃花仙境":5600, "愛塔-糖果機/時間通道":5824 }},
];
const MP_POTS = [
  {name:"柳橙", amount:50, prices:{ "防衛本部":95, "魔森":97, "其餘地圖":100 }},
  {name:"藍色藥水", amount:100, prices:{ "玩具城/糖果機/防衛本部":190, "魔森":192, "其餘地圖":200 }},
  {name:"檸檬", amount:150, prices:{ "防衛本部":294, "魔森":305, "其餘地圖":310 }},
  {name:"沙拉", amount:200, prices:{ "螞蟻洞":420 }},
  {name:"活力藥水", amount:300, prices:{ "玩具城/糖果機/防衛本部":589, "魔森":604, "其餘地圖":620 }},
  {name:"礦泉水", amount:800, prices:{ "防衛本部":1567, "煉金術士珍任務":1600, "多地區通用價":1650, "愛塔-糖果機":1716 }},
  {name:"紅豆刨冰", amount:2000, prices:{ "玩具城/糖果機/防衛本部":3800, "多地區通用價":4000 }},
  {name:"清晨之露", amount:4000, prices:{ "防衛本部":7695, "冰原/童話村/時間通道/不夜城/桃花仙境":8100, "愛塔-糖果機":8424 }},
  {name:"黃昏之露", amount:5000, prices:{ "防衛本部":9690, "冰原/童話村/時間通道/不夜城/桃花仙境":10200, "愛塔-糖果機":10608 }},
];
const MIX_POTS = [
  {name:"巧克力(1000/1000)", hp:1000, mp:1000, prices:{ "一般":3000, "玩具城":2850 }},
  {name:"蛋糕(100/100)", hp:100, mp:100, prices:{ "玩具城/糖果機":304, "螞蟻洞":320 }},
  {name:"西瓜(1000/1000)", hp:1000, mp:1000, prices:{ "防衛本部":3034, "煉金術士珍任務":3120, "多地區通用價":3200 }},
];

/* ================= UI 初始化 ================= */
function fillSelect(id, max){ const el=document.getElementById(id); el.innerHTML=""; for(let i=1;i<=max;i++){ const o=document.createElement("option"); o.value=i; o.textContent=i; el.appendChild(o);} }
["mgLv","maLv","teleLv"].forEach((id,idx)=>fillSelect(id, id==="teleLv"?20:20));
fillSelect("ampLv",30); fillSelect("poisonMistLv",30); fillSelect("poisonFogLv",30);

const priceLocSel=document.getElementById("priceLoc");
const ALL_LOCS = Array.from(new Set([
  ...HP_POTS.flatMap(p=>Object.keys(p.prices)),
  ...MP_POTS.flatMap(p=>Object.keys(p.prices)),
  ...MIX_POTS.flatMap(p=>Object.keys(p.prices))
]));
ALL_LOCS.forEach(loc=>{ const opt=document.createElement("option"); opt.value=loc; opt.textContent=loc; priceLocSel.appendChild(opt); });
priceLocSel.value=ALL_LOCS[0];

const priceModeSel=document.getElementById("priceMode");
priceModeSel.addEventListener("change", ()=>{
  const isLoc=priceModeSel.value==="loc";
  priceLocSel.disabled=!isLoc;
  document.getElementById("badgePriceMode").textContent=isLoc?`指定地點：${priceLocSel.value}`:"最低價";
  renderTables(); recalcAll();
});
priceLocSel.addEventListener("change", ()=>{ document.getElementById("badgePriceMode").textContent=`指定地點：${priceLocSel.value}`; renderTables(); recalcAll(); });

const autoModeSel=document.getElementById("autoMode");
autoModeSel.addEventListener("change", ()=>{ document.getElementById("manualRow").style.display = autoModeSel.value==="manual" ? "" : "none"; recalcAll(); });

/* ================= 工具 ================= */
function pickPrice(prices){ if(priceModeSel.value==="min"){ return Math.min(...Object.values(prices)); } const loc=priceLocSel.value; return (loc in prices)? prices[loc] : Math.min(...Object.values(prices)); }
function cp(amount, price){ return amount/price; }
function clamp(n,min,max){ return Math.max(min, Math.min(max, n)); }
function floor(n){ return Math.floor(n); }

/* ================= 計算核心 ================= */
function calcHitLoss(hit, mgLv){
  const mg=MAGIC_GUARD[mgLv-1]??{ratio:0};
  const r=mg.ratio/100;
  return { hpLoss: hit*(1-r), mpLoss: hit*r, mgRatio: mg.ratio };
}

function suggestThresholds(maxHP,maxMP,hit, mgLv, mode, manualHPpct, manualMPpct, teleLv, fogLv){
  const loss = calcHitLoss(hit, mgLv);
  let mpPct;
  if(mode==="678") mpPct=floor((678/maxMP)*100);
  else if(mode==="700") mpPct=floor((700/maxMP)*100);
  else if(mode==="800") mpPct=floor((800/maxMP)*100);
  else mpPct=clamp(floor(manualMPpct),1,99);

  // 初步目標（％→絕對值）
  let mpTarget = Math.ceil(mpPct/100 * maxMP);
  let hpPct = (mode==="manual")? clamp(floor(manualHPpct),1,99)
                                : clamp(floor(((maxHP - loss.hpLoss)/maxHP)*100)+1,1,99);
  let hpTarget = Math.ceil(hpPct/100 * maxHP);

  // 技能緩衝（連續操作安全量）
  const teleMP = TELEPORT[teleLv-1].mp;
  const fogMP  = POISON_FOG[fogLv-1].mp;
  const buffer = 2*teleMP + 2*fogMP;

  // **關鍵修正**：自動補後必須能「再扛下一刀」
  // MP 至少要能吸收下一刀的魔心份額 + 緩衝；HP 至少能扛下一刀留下的 HP 傷害
  mpTarget = Math.max(mpTarget, Math.ceil(loss.mpLoss + buffer));
  hpTarget = Math.max(hpTarget, Math.ceil(loss.hpLoss));

  // 轉回顯示百分比（僅作顯示）
  hpPct = clamp(floor(hpTarget/maxHP*100),1,99);
  mpPct = clamp(floor(mpTarget/maxMP*100),1,99);

  const note = `自動補後至少可再扛下一刀（HP≥${Math.round(loss.hpLoss)}、MP≥${Math.round(loss.mpLoss)}+緩衝${buffer}）。`;
  return {hpPct, mpPct, hpTarget, mpTarget, loss, note};
}

// 事件成本最省：允許一次觸發連吃多瓶，挑總成本最低且浪費最少的
function bestPotEvent(need, pots){
  let best=null;
  for(const p of pots){
    const price=pickPrice(p.prices);
    const amount=p.amount;
    const uses = Math.ceil(need/amount) || 0;
    const eventCost = uses * price;
    const over = Math.max(uses*amount - need, 0);
    const ratio = cp(amount, price);
    const cand={name:p.name, amount, price, uses, eventCost, over, ratio};
    if(!best || cand.eventCost<best.eventCost || (cand.eventCost===best.eventCost && cand.over<best.over)){
      best=cand;
    }
  }
  return best;
}

/* ================= 表格渲染 ================= */
function renderTable(containerId, headers, rows){
  const el=document.getElementById(containerId);
  const table=document.createElement("table");
  const thead=document.createElement("thead");
  const trh=document.createElement("tr");
  headers.forEach(h=>{ const th=document.createElement("th"); th.textContent=h; trh.appendChild(th); });
  thead.appendChild(trh); table.appendChild(thead);
  const tbody=document.createElement("tbody");
  rows.forEach(r=>{ const tr=document.createElement("tr"); r.forEach(c=>{ const td=document.createElement("td"); td.innerHTML=c; tr.appendChild(td); }); tbody.appendChild(tr); });
  table.appendChild(tbody); el.innerHTML=""; el.appendChild(table);
}

function renderTables(){
  const isLoc = priceModeSel.value==="loc";
  const hpRows = HP_POTS.map(p=>{ const price=pickPrice(p.prices); const locUsed=Object.keys(p.prices).find(k=>p.prices[k]===price)||"-"; return [p.name, p.amount, price, (p.amount/price).toFixed(3), isLoc? priceLocSel.value : `最低價於「${locUsed}」`]; });
  renderTable("hpTable", ["藥水名","補量(HP)","價格","轉換率","購買地"], hpRows);

  const mpRows = MP_POTS.map(p=>{ const price=pickPrice(p.prices); const locUsed=Object.keys(p.prices).find(k=>p.prices[k]===price)||"-"; return [p.name, p.amount, price, (p.amount/price).toFixed(3), isLoc? priceLocSel.value : `最低價於「${locUsed}」`]; });
  renderTable("mpTable", ["藥水名","補量(MP)","價格","轉換率","購買地"], mpRows);

  const mixRows = MIX_POTS.map(p=>{ const price=pickPrice(p.prices); const locUsed=Object.keys(p.prices).find(k=>p.prices[k]===price)||"-"; const ratio=((p.hp+p.mp)/price).toFixed(3); return [p.name, `${p.hp}&${p.mp}`, price, ratio, isLoc? priceLocSel.value : `最低價於「${locUsed}」`]; });
  renderTable("mixTable", ["藥水名","補量(HP&MP)","價格","比值","購買地"], mixRows);
}

/* ================= 重算（核心輸出） ================= */
function recalcAll(){
  const maxHP=+document.getElementById("maxHP").value||1;
  const maxMP=+document.getElementById("maxMP").value||1;
  const hitDmg=+document.getElementById("hitDmg").value||0;

  const mgLv=+document.getElementById("mgLv").value||1;
  const maLv=+document.getElementById("maLv").value||1;
  const teleLv=+document.getElementById("teleLv").value||1;
  const ampLv=+document.getElementById("ampLv").value||1;
  const mistLv=+document.getElementById("poisonMistLv").value||1;
  const fogLv=+document.getElementById("poisonFogLv").value||1;

  const manualHPpct=+document.getElementById("hpPctManual").value||80;
  const manualMPpct=+document.getElementById("mpPctManual").value||10;
  const mode=document.getElementById("autoMode").value;

  const {hpPct, mpPct, hpTarget, mpTarget, loss, note} = suggestThresholds(maxHP,maxMP,hitDmg,mgLv,mode, manualHPpct, manualMPpct, teleLv, fogLv);

  // 受到這刀後的即時 HP/MP
  const hpAfter = maxHP - loss.hpLoss;
  const mpAfter = maxMP - loss.mpLoss;

  // 真正缺口（要補到「目標」）
  // MP/HP 補正：魔力激發只影響技能耗魔，不影響補品；此處不加倍
  let needHP = Math.max(hpTarget - hpAfter, 0);
  let needMP = Math.max(mpTarget - mpAfter, 0);

  // 找「事件成本」最省的補法（允許一次觸發連吃多瓶）
  const hpPick = bestPotEvent(needHP, HP_POTS);
  const mpPick = bestPotEvent(needMP, MP_POTS);

  // 技能維護（每分鐘）
  const mg=MAGIC_GUARD[mgLv-1], ma=MAGIC_ARMOR[maLv-1];
  const mgPerMin = mg ? mg.mpCost * (60/(mg.durSec||60)) : 0;
  const maPerMin = ma ? ma.mpCost * (60/(ma.durSec||60)) : 0;

  // 極速詠唱/瞬移/毒霧耗魔（含魔力激發倍率）
  const amp = AMP_MAGIC[ampLv-1]||{costPct:100};
  const ampRate=(amp.costPct||100)/100;
  const teleOnce = TELEPORT[teleLv-1].mp * ampRate;
  const mistOnce = POISON_MIST[mistLv-1].mp * ampRate;
  const fogOnce  = POISON_FOG[fogLv-1].mp  * ampRate;

  const sum=document.getElementById("summary");
  sum.innerHTML = `
    <div class="callout ok">
      <div>🛡️ 魔心替代率：<b>${mg?.ratio||0}%</b>（Lv.${mgLv}，維護：${mg?.mpCost||0} MP / ${mg?.durSec||0}s）</div>
      <div>🧷 魔力之盾：Lv.${maLv}（維護：${ma?.mpCost||0} MP / ${ma?.durSec||0}s）</div>
    </div>
    <div class="callout">
      <div>💥 本刀實損 ≈ <b>HP ${Math.round(loss.hpLoss)}</b>、<b>MP ${Math.round(loss.mpLoss)}</b></div>
      <div class="muted">（傷害 ${hitDmg}；魔心分流 ${mg?.ratio||0}% → MP）</div>
    </div>
    <div class="callout">
      <div>🧮 建議自動補門檻 → HP <b>${hpPct}%</b>（≥本刀HP損），MP <b>${mpPct}%</b>（≥本刀MP損＋緩衝）</div>
      <div class="muted">${note}</div>
    </div>
    <div class="callout">
      <div>🧱 技能維護（估每分鐘）：魔心 ${mgPerMin.toFixed(1)} MP、魔盾 ${maPerMin.toFixed(1)} MP</div>
      <div class="muted">瞬移 ${Math.round(teleOnce)} MP／次、毒霧 ${Math.round(mistOnce)} MP／次、致命毒霧 ${Math.round(fogOnce)} MP／次（含魔力激發倍率）</div>
    </div>
  `;

  const reco=document.getElementById("reco");
  const hpCp1000 = hpPick ? (1000*hpPick.price/hpPick.amount).toFixed(1) : "-";
  const mpCp1000 = mpPick ? (1000*mpPick.price/mpPick.amount).toFixed(1) : "-";
  reco.innerHTML = `
    <div class="callout ok">
      <div>✅ HP：<b>${hpPick.name}</b>　需要補回 <b>${Math.round(needHP)}</b> → <b>每次觸發吃 ${hpPick.uses} 瓶</b>，花費 ≈ <b>$${hpPick.eventCost}</b>
      <span class="badge">每1000量 ≈ $${hpCp1000}</span></div>
      <div class="muted">若想減少連吃次數，改用更大瓶（如：烤鰻魚/棒冰棒/乳酪）。</div>
    </div>
    <div class="callout ok">
      <div>✅ MP：<b>${mpPick.name}</b>　需要補回 <b>${Math.round(needMP)}</b> → <b>每次觸發吃 ${mpPick.uses} 瓶</b>，花費 ≈ <b>$${mpPick.eventCost}</b>
      <span class="badge">每1000量 ≈ $${mpCp1000}</span></div>
      <div class="muted">魔心吃傷主要在 MP；大缺口情境會自然推薦礦泉水/紅豆刨冰/清晨之露，而非柳橙。</div>
    </div>
  `;
}

/* ================= 表格與事件綁定 ================= */
function renderAll(){ renderTables(); recalcAll(); }
document.getElementById("recalc").addEventListener("click", recalcAll);
["mgLv","maLv","teleLv","ampLv","poisonMistLv","poisonFogLv","maxHP","maxMP","hitDmg","hpPctManual","mpPctManual"].forEach(id=>{
  document.getElementById(id).addEventListener("input", recalcAll);
  document.getElementById(id).addEventListener("change", recalcAll);
});
renderAll();
</script>
</body>
</html>
