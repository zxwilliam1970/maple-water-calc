<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>æ¥“ä¹‹è°· è£œæ°´æ•ˆç‡åŠ©æ‰‹ï¼ˆArtaleç‰ˆï¼‰</title>
<style>
  body{font-family:"Microsoft JhengHei",Arial,sans-serif;background:#f4f6f8;margin:0;padding:16px;color:#222}
  .wrap{max-width:920px;margin:18px auto;background:#fff;padding:18px;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,0.06)}
  h1{margin:0 0 8px;color:#c0392b}
  label{display:block;margin-top:10px;font-size:14px}
  input,select{padding:8px;width:100%;max-width:320px;margin-top:6px;border-radius:6px;border:1px solid #d0d7dd}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  .col{flex:1;min-width:220px}
  button{margin-top:14px;padding:10px 14px;background:#2d8cf0;color:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:600}
  .result{margin-top:18px;padding:14px;background:#fbfdff;border-left:4px solid #2d8cf0;border-radius:6px}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{border:1px solid #e6edf3;padding:6px;text-align:center;font-size:13px}
  th{background:#f7fbff}
  small{color:#666}
  .note{font-size:13px;color:#555;margin-top:10px}
</style>
</head>
<body>
<div class="wrap">
  <h1>æ¥“ä¹‹è°· è£œæ°´æ•ˆç‡åŠ©æ‰‹ï¼ˆArtaleç‰ˆï¼‰</h1>
  <p><small>æ³•å¸«ï¼ˆç«æ¯’ï¼‰å°ˆç”¨ â€” å…§å»ºé­”å¿ƒ/é­”åŠ›ä¹‹ç›¾ã€678 ç†è«–èˆ‡å¸¸ç”¨è£œå“è³‡æ–™ã€‚å¡«å®Œåƒæ•¸æŒ‰ã€Œè¨ˆç®—ã€çœ‹å»ºè­°ã€‚</small></p>

  <!-- è¼¸å…¥å€ -->
  <div class="row">
    <div class="col">
      <label>æœ€å¤§ HP</label>
      <input id="inpHP" type="number" placeholder="ä¾‹å¦‚ 1500" />
    </div>
    <div class="col">
      <label>æœ€å¤§ MP</label>
      <input id="inpMP" type="number" placeholder="ä¾‹å¦‚ 7000" />
    </div>
    <div class="col">
      <label>è¢«æ“Šä¸­é »ç‡ï¼ˆæ¬¡ / åˆ†é˜ï¼Œæ¸¬ä¸åˆ°å¯ç•™ 0ï¼‰</label>
      <input id="hitsPerMin" type="number" placeholder="ä¾‹å¦‚ 30ï¼ˆæ¯åˆ†é˜è¢«æ‰“ 30 æ¬¡ï¼‰" />
    </div>
  </div>

  <div class="row">
    <div class="col">
      <label>é­”å¿ƒé˜²ç¦¦ ç­‰ç´šï¼ˆ1~20ï¼‰</label>
      <select id="magicHeartLevel"></select>
    </div>
    <div class="col">
      <label>é­”åŠ›ä¹‹ç›¾ ç­‰ç´šï¼ˆ0~20ï¼‰</label>
      <select id="magicShieldLevel"></select>
    </div>
    <div class="col">
      <label>æ¨¡å¼</label>
      <select id="mode">
        <option value="manual">æ‰‹å‹•ï¼ˆè‡ªè¨‚æŠ€èƒ½æ–½æ”¾æ¬¡æ•¸ï¼‰</option>
        <option value="678" selected>678 ç†è«–ï¼ˆå»ºè­°é è¨­ï¼‰</option>
      </select>
    </div>
  </div>

  <!-- æŠ€èƒ½æ–½æ”¾ï¼ˆæ‰‹å‹•æ¨¡å¼å¯å¡«ï¼›è‹¥ç‚º 678ï¼Œæœƒç”¨é è¨­ä¼°å€¼ï¼‰ -->
  <div class="row" style="margin-top:10px">
    <div class="col">
      <label>ç¬é–“ç§»å‹• ç­‰ç´šï¼ˆ1~20ï¼‰</label>
      <input id="teleLevel" type="number" placeholder="ç­‰ç´š" />
    </div>
    <div class="col">
      <label>æ¯’éœ§ ç­‰ç´šï¼ˆ1~30ï¼‰</label>
      <input id="poisonLevel" type="number" placeholder="ç­‰ç´š" />
    </div>
    <div class="col">
      <label>è‡´å‘½æ¯’éœ§ ç­‰ç´šï¼ˆ1~30ï¼‰</label>
      <input id="deadlyLevel" type="number" placeholder="ç­‰ç´š" />
    </div>
  </div>

  <div class="row">
    <div class="col">
      <label>ç¬é–“ç§»å‹• æ¬¡æ•¸ / åˆ†é˜ï¼ˆæ‰‹å‹•æ¨¡å¼ï¼‰</label>
      <input id="telePerMin" type="number" placeholder="ç•™ç©ºæˆ– 0 ä½¿ç”¨æ¨¡å¼é è¨­" />
    </div>
    <div class="col">
      <label>æ¯’éœ§ æ¬¡æ•¸ / åˆ†é˜ï¼ˆæ‰‹å‹•æ¨¡å¼ï¼‰</label>
      <input id="poisonPerMin" type="number" placeholder="ç•™ç©ºæˆ– 0 ä½¿ç”¨æ¨¡å¼é è¨­" />
    </div>
    <div class="col">
      <label>è‡´å‘½æ¯’éœ§ æ¬¡æ•¸ / åˆ†é˜ï¼ˆæ‰‹å‹•æ¨¡å¼ï¼‰</label>
      <input id="deadlyPerMin" type="number" placeholder="ç•™ç©ºæˆ– 0 ä½¿ç”¨æ¨¡å¼é è¨­" />
    </div>
  </div>

  <div style="margin-top:8px">
    <label>ï¼ˆé¸å¡«ï¼‰é­”åŠ›æ¿€ç™¼ æ˜¯å¦å•Ÿç”¨</label>
    <select id="mbOn">
      <option value="0" selected>å¦</option>
      <option value="1">æ˜¯ï¼ˆæœƒå¢åŠ  MP æ¶ˆè€—å€æ•¸ï¼‰</option>
    </select>
  </div>

  <button id="calcBtn">è¨ˆç®—</button>

  <!-- çµæœå€ -->
  <div id="result" class="result" style="display:none"></div>

  <div class="note">
    <strong>èªªæ˜ï¼š</strong> 678 ç†è«–é è¨­æœƒæŠŠè‡ªå‹•è£œ MP é–¾å€¼è¨­ç‚º <em>678</em>ï¼ˆè‹¥ä½ çš„ max MP &gt; 678ï¼‰ï¼›ä½ ä¹Ÿå¯ä»¥æ‰‹å‹•èª¿æ•´è¢«æ“Šé »ç‡æˆ–æ¯åˆ†é˜æ–½æ³•æ¬¡æ•¸ä»¥æ›´è²¼è¿‘ä½ çš„æ“ä½œã€‚
  </div>
</div>

<script>
/*
  æœ€çµ‚ç‰ˆé‚è¼¯èªªæ˜ï¼ˆç°¡è¦ï¼‰ï¼š
  - å…§å»ºé­”å¿ƒï¼ˆé­”å¿ƒé˜²ç¦¦ï¼‰èˆ‡é­”åŠ›ä¹‹ç›¾ç­‰ç´šè¡¨ï¼ˆè³‡æ–™ä¾†æºï¼šä½ æä¾›ï¼‰
  - å…§å»ºå¸¸ç”¨è£œå“ï¼ˆMP / HP èˆ‡åƒ¹æ ¼ï¼‰ä¾› CP æ¯”è¼ƒ
  - å¦‚æœ mode=manualï¼šæ¡ç”¨ä½¿ç”¨è€…è¼¸å…¥çš„æ¯åˆ†é˜æ–½æ”¾æ¬¡æ•¸ï¼ˆè‹¥æ¬„ä½ç‚ºç©ºï¼Œä½¿ç”¨é è¨­ï¼‰
  - å¦‚æœ mode=678ï¼šä½¿ç”¨é è¨­æ–½æ”¾é »ç‡ï¼ˆæ¯”è¼ƒä¿å®ˆ/è²¼åˆ 678 ç†è«–ï¼‰
  - è¼¸å‡ºï¼šæ¯åˆ†é˜ / æ¯å°æ™‚ MP æ¶ˆè€—ï¼ˆæŠ€èƒ½ + è¢«æ‰“è½‰ MPï¼‰ï¼Œæ‰€éœ€è£œå“æ•¸é‡èˆ‡æ¯å°æ™‚èŠ±è²»ï¼Œä¸¦åˆ—å‡º CP å€¼æ’åº
*/

// --- 1) å®šç¾©è³‡æ–™ï¼šé­”å¿ƒã€é˜²ç›¾è¡¨ï¼ˆç”±ä½ æä¾›ï¼‰ï¼Œä»¥åŠå¸¸ç”¨è£œå“ï¼ˆMPï¼HPï¼åƒ¹æ ¼ï¼‰
const magicHeart = [
  null,
  {mpCost:6, duration:30, replace:0.04},{mpCost:6, duration:60, replace:0.08},{mpCost:6, duration:90, replace:0.12},
  {mpCost:6, duration:120, replace:0.16},{mpCost:6, duration:150, replace:0.20},{mpCost:6, duration:180, replace:0.24},
  {mpCost:6, duration:210, replace:0.28},{mpCost:6, duration:240, replace:0.32},{mpCost:6, duration:270, replace:0.36},
  {mpCost:6, duration:300, replace:0.40},{mpCost:12, duration:330, replace:0.44},{mpCost:12, duration:360, replace:0.48},
  {mpCost:12, duration:390, replace:0.52},{mpCost:12, duration:420, replace:0.56},{mpCost:12, duration:450, replace:0.60},
  {mpCost:12, duration:480, replace:0.64},{mpCost:12, duration:510, replace:0.68},{mpCost:12, duration:540, replace:0.72},
  {mpCost:12, duration:570, replace:0.76},{mpCost:12, duration:600, replace:0.80}
];

const magicShield = [
  null,
  {mpCost:8,duration:20,def:2},{mpCost:8,duration:40,def:4},{mpCost:8,duration:60,def:6},{mpCost:8,duration:80,def:8},
  {mpCost:8,duration:100,def:10},{mpCost:8,duration:120,def:12},{mpCost:8,duration:140,def:14},{mpCost:8,duration:160,def:16},
  {mpCost:8,duration:180,def:18},{mpCost:8,duration:200,def:20},{mpCost:16,duration:220,def:22},{mpCost:16,duration:240,def:24},
  {mpCost:16,duration:260,def:26},{mpCost:16,duration:280,def:28},{mpCost:16,duration:300,def:30},{mpCost:16,duration:320,def:32},
  {mpCost:16,duration:340,def:34},{mpCost:16,duration:360,def:36},{mpCost:16,duration:380,def:38},{mpCost:16,duration:400,def:40}
];

// è£œå“è³‡æ–™ï¼ˆä»¥ä½ æä¾›è¡¨æ ¼å¸¸ç”¨é …ç›®ç‚ºä¸» â€” MP é¡èˆ‡ HP é¡ï¼‰
// æ ¼å¼: {id,name, mp, hp, price, note}
const potions = [
  // MP è—¥æ°´ï¼ˆåç¨±ã€MP è£œé‡ã€åƒ¹æ ¼ï¼‰
  {id:'orange', name:'æŸ³æ©™(å°è—)', mp:50, hp:0, price:95, note:'å°è— / é­”æ£®åƒ¹å·®ç•¥æœ‰ä¸åŒ'},
  {id:'blue_small', name:'è—è‰²è—¥æ°´(å°)', mp:100, hp:0, price:190, note:''},
  {id:'lemon', name:'æª¸æª¬', mp:150, hp:0, price:294, note:''},
  {id:'energy', name:'æ´»åŠ›è—¥æ°´', mp:300, hp:0, price:589, note:''},
  {id:'spring', name:'ç¤¦æ³‰æ°´', mp:800, hp:0, price:1567, note:'å¸¸ç”¨CPé«˜(Artaleé˜²è¡›æœ¬éƒ¨åƒ¹)'}, 
  {id:'redshavedice', name:'ç´…è±†åˆ¨å†°', mp:2000, hp:0, price:3800, note:'CP é«˜ä½†è²´'},
  {id:'dawn', name:'æ¸…æ™¨ä¹‹éœ²', mp:4000, hp:0, price:7695, note:''},
  {id:'dusk', name:'é»ƒæ˜ä¹‹éœ²', mp:5000, hp:0, price:9690, note:''},
  // ç¶œåˆ / HP è—¥æ°´å¸¸ç”¨
  {id:'chocolate', name:'å·§å…‹åŠ›(ç¶œåˆ)', mp:1000, hp:1000, price:3000, note:'ç¶œåˆ:HP+MP'},
  {id:'eel', name:'çƒ¤é°»é­š (HP)', mp:0, hp:1000, price:1045, note:'å¸¸ç”¨ HP é£Ÿç‰©'},
  {id:'cake', name:'è›‹ç³•(å°ç¶œåˆ)', mp:100, hp:100, price:304, note:''}
];

// å…§å»ºæŠ€èƒ½ MP æ¶ˆè€—ï¼ˆä¾ç­‰ç´šæ˜ å°„çš„éƒ¨åˆ†åªåŒ…å«å¸¸ç”¨æŠ€èƒ½ç­‰ç´šçš„æ¶ˆè€—ï¼›æˆ‘å€‘ç”¨åƒè€ƒå€¼ï¼‰
// ç¬é–“ç§»å‹•ï¼ˆlevel1..20 æ¶ˆè€—è¡¨ï¼‰
const teleportCostByLevel = [0,60,57,54,51,48,45,42,39,36,33,31,29,27,25,23,21,19,17,15,13]; // level index
// æ¯’éœ§ï¼ˆpoisonï¼‰(level1..30) -> user gave constant MP10 up to 15 then 20 etc. æˆ‘å€‘ä»¥å¸¸è¦‹ç‚º 10~20
function poisonCost(level){
  if(!level) return 0;
  return (level<=15?10:20);
}
// è‡´å‘½æ¯’éœ§
function deadlyCost(level){
  if(!level) return 0;
  // from data: level1 mp21 ... increase slowly - we approximate
  if(level<=10) return 21 + (level-1);
  if(level<=20) return 30 + (level-10);
  return 40;
}

// é­”åŠ›æ¿€ç™¼æœƒé€ æˆæ¶ˆè€—å€æ•¸
function manaBoostMultiplier(on){
  return on?2.0:1.0;
}

// 678 æ¨¡å¼çš„é è¨­æ–½æ”¾é »ç‡ï¼ˆæ¯åˆ†é˜ï¼‰ï¼šé€™æ˜¯ä¿å®ˆé è¨­ï¼Œå¯ä»¥å¾®èª¿
const presetFreqs_678 = {
  tele_per_min: 5,   // ç¬ç§» (ç”¨ä¾†ç§»ä½/æ‹‰æ€ª) æ¯åˆ†é˜5æ¬¡
  poison_per_min: 12, // æ¯’éœ§ æ¯åˆ†é˜ç´„12æ¬¡
  deadly_per_min: 4   // è‡´å‘½æ¯’éœ§ æ¯åˆ†é˜4æ¬¡ï¼ˆè¼ƒé »ç¹æˆ–è¼ƒå°‘è¦–ç­‰ç´šï¼‰
};

// è¼”åŠ©ï¼šæŠŠæ•¸å­—æ ¼å¼åŒ–ç‚ºæ•´æ•¸åƒä½
function nf(n){ return n.toLocaleString(); }

// ä¸»è¨ˆç®—å‡½å¼
function compute(){
  // è®€è¼¸å…¥
  const maxHP = Math.max(0, parseInt(document.getElementById('inpHP').value || 0));
  const maxMP = Math.max(0, parseInt(document.getElementById('inpMP').value || 0));
  const hitsPerMin = Math.max(0, parseFloat(document.getElementById('hitsPerMin').value || 0));
  const mhLv = parseInt(document.getElementById('magicHeartLevel').value || 1);
  const msLv = parseInt(document.getElementById('magicShieldLevel').value || 0);
  const mode = document.getElementById('mode').value;
  const teleLv = parseInt(document.getElementById('teleLevel').value || 0);
  const poisonLv = parseInt(document.getElementById('poisonLevel').value || 0);
  const deadlyLv = parseInt(document.getElementById('deadlyLevel').value || 0);
  const telePerMin_user = parseFloat(document.getElementById('telePerMin').value || 0);
  const poisonPerMin_user = parseFloat(document.getElementById('poisonPerMin').value || 0);
  const deadlyPerMin_user = parseFloat(document.getElementById('deadlyPerMin').value || 0);
  const mbOn = document.getElementById('mbOn').value === '1';

  // magic heart / shield data
  const mh = magicHeart[mhLv];
  const ms = magicShield[msLv];

  // MP é–¾å€¼ï¼šè‹¥ä½¿ç”¨ 678 ç†è«–ï¼Œæ¨è–¦ç”¨å›ºå®š 678ï¼ˆè‹¥ä½ çš„ maxMP < 678ï¼Œå‰‡å– maxMP*10%ï¼‰
  let mpTrigger;
  if(mode === '678'){
    mpTrigger = (maxMP >= 678) ? 678 : Math.ceil(maxMP * 0.10);
  } else {
    // é è¨­ç”¨ä½¿ç”¨è€…ç™¾åˆ†æ¯”ï¼Ÿï¼ˆæˆ‘å€‘æ²’æœ‰å¦è¨­æ¬„ä½ï¼Œç©å®¶å¯æ‰‹å‹•æ”¹é€™æ•¸å€¼ï¼‰
    mpTrigger = Math.ceil(maxMP * 0.11);
  }

  // æŠ€èƒ½æ¯åˆ†é˜æ¶ˆè€— (ä»¥ç©å®¶è¼¸å…¥ç‚ºæº–ï¼›è‹¥æœªè¼¸å…¥ã€mode=678ï¼Œä½¿ç”¨ preset)
  const telePerMin = (telePerMin_user>0) ? telePerMin_user : (mode==='678' ? presetFreqs_678.tele_per_min : 0);
  const poisonPerMin = (poisonPerMin_user>0) ? poisonPerMin_user : (mode==='678' ? presetFreqs_678.poison_per_min : 0);
  const deadlyPerMin = (deadlyPerMin_user>0) ? deadlyPerMin_user : (mode==='678' ? presetFreqs_678.deadly_per_min : 0);

  // å–®æ¬¡æŠ€èƒ½ MP æ¶ˆè€—
  const teleportCost = (teleLv>0 && teleLv<=20) ? teleportCostByLevel[teleLv] : 0;
  const poisonCostSingle = poisonCost(poisonLv);
  const deadlyCostSingle = deadlyCost(deadlyLv);

  // è‹¥å•Ÿç”¨é­”åŠ›æ¿€ç™¼ï¼Œä¹˜ä¸Šå€æ•¸
  const mbMul = manaBoostMultiplier(mbOn);

  // æŠ€èƒ½æ¯åˆ†é˜ MP æ¶ˆè€—
  const mpSkillPerMin = Math.ceil( (telePerMin*teleportCost + poisonPerMin*poisonCostSingle + deadlyPerMin*deadlyCostSingle) * mbMul );

  // é­”å¿ƒã€é­”ç›¾ é€ æˆçš„æŒçºŒè€—é­”ï¼ˆå–æ¯åˆ†é˜å¹³å‡ï¼‰
  // é­”å¿ƒï¼šæ¶ˆè€— mpCost æ¯ duration ç§’ -> æ¯åˆ†é˜è€— = mpCost / duration * 60
  const mhMpPerMin = mh ? (mh.mpCost / mh.duration * 60) : 0;
  // é­”åŠ›ä¹‹ç›¾ï¼šæ¯ duration ç§’æ¶ˆè€— mpCost -> æ¯åˆ†é˜è€— = mpCost / duration * 60
  const msMpPerMin = ms ? (ms.mpCost / ms.duration * 60) : 0;

  // è¢«æ‰“é€ æˆçš„ MP æ¶ˆè€—ï¼ˆé­”å¿ƒæœƒå°‡éƒ¨åˆ†å‚·å®³æ”¹æˆ MP æ‰¿æ“”ï¼‰
  // å‡è¨­å¹³å‡æ¯æ¬¡è¢«æ‰“é€ æˆ avgDamageï¼ˆçŒœæ¸¬ï¼‰ - é€™è£¡ä½¿ç”¨ä¸€å€‹åˆç†é è¨­ï¼šè‹¥ maxHP < 2000 å‰‡ avgDamage=500ï¼Œå¦å‰‡ 800
  const avgDamage = Math.max(200, (maxHP < 2000 ? 500 : 800));
  // æ¯æ¬¡è¢«æ‰“æ™‚é­”å¿ƒæœƒå°‡ replace% * damage è®Šæˆ MP æ‰£ï¼ˆè‹¥æ²’æœ‰é­”å¿ƒå‰‡ç‚º0ï¼‰
  const mhReplaceRate = mh ? mh.replace : 0;
  const mpAbsorbPerHit = Math.ceil(avgDamage * mhReplaceRate);
  const mpFromHitsPerMin = Math.ceil(mpAbsorbPerHit * hitsPerMin);

  // æ¯åˆ†é˜ç¸½ MP æ¶ˆè€— = æŠ€èƒ½ + æŒçºŒæŠ€èƒ½(é­”å¿ƒ/ç›¾) + è¢«æ‰“è½‰ MP
  const totalMpPerMin = Math.ceil(mpSkillPerMin + mhMpPerMin + msMpPerMin + mpFromHitsPerMin);
  const totalMpPerHour = totalMpPerMin * 60;

  // è£œå“è¨ˆç®—ï¼šè¨ˆç®—æ¯ç¨®è—¥æ°´è¦è£œæ»¿ã€Œä¸€å°æ™‚æ¶ˆè€—ã€éœ€è¦çš„æ•¸é‡èˆ‡åƒ¹æ ¼
  const potResults = potions.map(p => {
    const needed = Math.ceil(totalMpPerHour / Math.max(1, p.mp)); // è‹¥ p.mp=0(HP only) å‰‡åˆ†æ¯ç‚º1é¿å…é™¤0ï¼›å¾Œé¢æœƒéæ¿¾
    const cost = needed * p.price;
    const cp = (p.mp>0) ? (p.mp / p.price) : 0;
    return {...p, needed, cost, cp};
  }).filter(x => x.mp>0) // åƒ…åˆ— MP é¡è—¥æ°´ç‚ºä¸»è¦æ¯”è¼ƒå°è±¡
  .sort((a,b) => b.cp - a.cp);

  // æ¨è–¦ï¼šCP æœ€ä½³çš„è—¥æ°´ï¼ˆå–®ä¸€ï¼‰
  const bestPotion = potResults[0];

  // è¤‡åˆå»ºè­°ï¼šè‹¥éœ€ HP è£œå“ï¼ˆä»¥é°»é­šç‚ºä¸»è¦ HP ä¾†æºï¼‰
  // ç”¨ hpThresholdï¼ˆå– 80% ç‚ºé è¨­ï¼‰ç®—å‡ºæ¯å°æ™‚éœ€è¦å¤šå°‘ HP è£œå›ï¼ˆä¼°ç®—ï¼šè¢«æ‰“ç¸½ HP æå¤±ï¼‰
  // ç‚ºç°¡åŒ–ï¼šä¼°ç®—æ¯åˆ†é˜ HP æå¤± = hitsPerMin * avgDamage * (1 - mhReplaceRate)
  const hpPerMinTaken = Math.ceil(hitsPerMin * avgDamage * (1 - mhReplaceRate));
  const hpPerHourTaken = hpPerMinTaken * 60;
  // æ‰¾åˆ°é°»é­š (id 'eel')
  const eel = potions.find(p=>p.id==='eel');
  // è¨ˆç®—é°»é­šæ¯å°æ™‚éœ€è¦æ•¸é‡ï¼ˆè‹¥ eel å­˜åœ¨ä¸” hpPerHourTaken>0ï¼‰
  let eelNeeded=0, eelCost=0;
  if(eel && eel.hp>0 && hpPerHourTaken>0){
    eelNeeded = Math.ceil(hpPerHourTaken / eel.hp);
    eelCost = eelNeeded * eel.price;
  }

  // è¼¸å‡ºçµæœå­—ä¸²
  let out = '';
  out += `<h3>è¨ˆç®—çµæœï¼ˆä¼°ç®—ï¼‰</h3>`;
  out += `<b>åŸºç¤åƒæ•¸</b>ï¼š æœ€å¤§ HP ${nf(maxHP)}, æœ€å¤§ MP ${nf(maxMP)}ï¼Œæ¯åˆ†é˜è¢«æ‰“ ${nf(hitsPerMin)} æ¬¡ï¼ˆå¹³å‡å‚·å®³ ${nf(avgDamage)}ï¼‰<br>`;
  out += `<b>é­”å¿ƒ Lv${mh ? (mhLv) : 0}</b>ï¼šæ›¿ä»£ç‡ ${(mhReplaceRate*100).toFixed(1)}%ï¼Œæ¯åˆ†é˜è€— MP ${mhMpPerMin.toFixed(2)}<br>`;
  out += `<b>é­”ç›¾ Lv${msLv}</b>ï¼šæ¯åˆ†é˜è€— MP ${msMpPerMin.toFixed(2)}<br>`;
  out += `<hr>`;
  out += `<b>æŠ€èƒ½ MP æ¶ˆè€—ï¼ˆæ¯åˆ†é˜ï¼‰</b>ï¼š ${nf(mpSkillPerMin)} MP / åˆ†é˜<br>`;
  out += `<b>è¢«æ‰“è½‰ MPï¼ˆæ¯åˆ†é˜ï¼‰</b>ï¼š ${nf(mpFromHitsPerMin)} MP / åˆ†é˜ (æ¯æ¬¡è¢«æ‰“è½‰ ${nf(mpAbsorbPerHit)} MP)<br>`;
  out += `<b>ç³»çµ±æŒçºŒè€— MPï¼ˆæ¯åˆ†é˜ï¼‰</b>ï¼šé­”å¿ƒ+é­”ç›¾åˆè¨ˆ ${nf((mhMpPerMin+msMpPerMin).toFixed(2))} MP / åˆ†é˜<br>`;
  out += `<h4>â†’ æ¯åˆ†é˜ç¸½è€— MPï¼š ${nf(totalMpPerMin)} MP</h4>`;
  out += `<h4>â†’ æ¯å°æ™‚ç¸½è€— MPï¼š ${nf(totalMpPerHour)} MP</h4>`;

  out += `<hr><h3>è£œå“å»ºè­°ï¼ˆMP é¡ï¼Œä¾ CP å€¼æ’åºï¼‰</h3>`;
  out += `<table><tr><th>è£œå“</th><th>æ¯å–®ä½ MP</th><th>åƒ¹æ ¼</th><th>æ¯å°æ™‚æ‰€éœ€æ•¸é‡</th><th>æ¯å°æ™‚ç¸½åƒ¹</th><th>CP (MP/é‡‘å¹£)</th></tr>`;
  potResults.forEach(p=>{
    out += `<tr><td>${p.name}</td><td>${nf(p.mp)}</td><td>${nf(p.price)}</td><td>${nf(p.needed)}</td><td>${nf(p.cost)}</td><td>${p.cp.toFixed(3)}</td></tr>`;
  });
  out += `</table>`;

  out += `<hr><h3>æ¨è–¦çµ„åˆèˆ‡å‚™è¨»</h3>`;
  if(bestPotion){
    out += `<p>ğŸ¥‡ å–®ä¸€æœ€æ¨è–¦ï¼ˆCPæœ€é«˜ï¼‰ï¼š<b>${bestPotion.name}</b>ï¼ˆCP=${bestPotion.cp.toFixed(3)}ï¼‰ â€” æ¯å°æ™‚ç´„éœ€ ${nf(bestPotion.needed)} å€‹ï¼ŒèŠ±è²» ${nf(bestPotion.cost)}ã€‚</p>`;
  } else {
    out += `<p>ç„¡å¯ç”¨ MP è—¥æ°´è³‡æ–™ã€‚</p>`;
  }
  if(eelNeeded>0){
    out += `<p>â¤ï¸ HP è£œå“å»ºè­°ï¼šè‹¥è¦è£œ HPï¼Œå¤§å¤šç©å®¶ä½¿ç”¨ <b>${eel.name}</b>ï¼Œä¼°è¨ˆæ¯å°æ™‚éœ€ ${nf(eelNeeded)} å€‹ï¼ŒèŠ±è²» ${nf(eelCost)}ã€‚</p>`;
  } else {
    out += `<p>HP æå¤±ä¼°è¨ˆä½ï¼Œæˆ–æœªæä¾› HP è—¥è³‡è¨Šã€‚</p>`;
  }

  out += `<p class="note"><strong>æ³¨æ„ï¼š</strong> ä»¥ä¸Šç‚ºã€Œä¼°ç®—ã€ã€‚å¯¦éš›è«‹ä»¥ä½ åœ¨ç·´åŠŸæ™‚çš„å¯¦æ¸¬è³‡æ–™ï¼ˆè¢«æ‰“æ¬¡æ•¸ã€å¯¦éš›æ–½æ”¾é »ç‡ã€åœ°åœ–æ€ªç‰©å‚·å®³ï¼‰å¾®èª¿è§¸ç™¼ç™¾åˆ†æ¯”èˆ‡è£œå“ã€‚</p>`;

  document.getElementById('result').style.display = 'block';
  document.getElementById('result').innerHTML = out;
}

// init selects
(function init(){
  const mhSel = document.getElementById('magicHeartLevel');
  const msSel = document.getElementById('magicShieldLevel');
  for(let i=1;i<=20;i++){
    const opt1 = document.createElement('option'); opt1.value=i; opt1.textContent=i; mhSel.appendChild(opt1);
    const opt2 = document.createElement('option'); opt2.value=i; opt2.textContent=i; msSel.appendChild(opt2);
  }
  // é è¨­
  mhSel.value = 3;
  msSel.value = 20;
  document.getElementById('teleLevel').value = 5;
  document.getElementById('poisonLevel').value = 10;
  document.getElementById('deadlyLevel').value = 10;
})();

document.getElementById('calcBtn').addEventListener('click', compute);
</script>
</body>
</html>